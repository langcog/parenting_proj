---
title: "A performance model for early word learning"
bibliography: parenting.bib
csl: apa6.csl
document-params: "10pt, letterpaper"

author-information: 
    \author{{\large \bf Emily Hembacher} \\ \texttt{ehembach@stanford.edu} \\ Department of Psychology \\ Stanford University \And {\large \bf Michael C. Frank} \\ \texttt{mcfrank@stanford.edu} \\ Department of Psychology \\ Stanford University}

abstract: 
    "..."

keywords:
    "Parenting attitudes; implicit theories"

output: cogsci2016::cogsci_paper
---

```{r global_options, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(fig.width=3.5, fig.height=3, fig.crop = FALSE, 
fig.pos = "ht", fig.path='figs/',
echo=FALSE, warning=FALSE, cache=TRUE, 
message=FALSE, sanitize=TRUE)
```

```{r, libraries}
suppressPackageStartupMessages(c("dplyr","langcog","tidyr","ggplot2","lme4"))
library(psych)
library(rjson)
library(tidyr)
library(psych)
library(nFactors)
library(lme4)

library(ggplot2)
library(dplyr)
library(langcog)
library(directlabels)
library(stringr)
library(magrittr)
library(readr)
library(ggrepel)
```

Child development research is constantly generating information that can be brought to bear on best-practices for parenting. For example, research on children’s learning has demonstrated that pedagogy can improve learning in some contexts and limit it in others, suggesting that allowing children to play freely and explore is critical for learning (Bonawitz et al., 2011; Buchsbaum, Gopnik, Griffiths, & Shafto, 2011). Likewise, a great deal of research has demonstrated the importance of engaging young children in elaborative conversations for language development and future academic success (Hart & Risley, 1995; Hoff, 2003; Huttenlocher, Waterfall, Vasilyeva, Vevea, & Hedges, 2010). A fundamental challenge we face is how to communicate the results of such scientific inquiry to a diverse public in a way that maximizes uptake and improves people’s daily and long-term decision making.

One critical parameter that may moderate the uptake of new information is parents’ implicit theories about child development and parenting. Research on implicit theories has found that people’s lay theories in different domains (which may or may not be explicitly articulated) organize the processing of new information. For example, people with an entity theory of personality tend to interpret people’s behaviors as stemming from fixed personality traits rather than situational factors such as needs, goals, or emotional states (Dweck, Chiu, & Hong, 1995). Similarly, there is evidence that people use lay theories about emotion in order to infer people’s current emotions from contextual cues (Ong, Zaki, & Goodman, 2015).

To provide an example of how lay theories might operate in the domain of parenting, parents who believe that children are not capable of learning before they are able to speak may be slower to uptake information suggesting that free play is helpful for causal learning among infants. Indeed, there is evidence supporting the notion that parents’ behaviors are guided by implicit lay theories about child development, which vary by SES and across cultures. For example, cross-cultural studies have found profound differences in how parents interact with infants; Richman, Miller & LeVine (1992) found that mothers in the Gusii community of Kenya primarily engaged with their children to soothe them when upset, but did not often speak to them with the goal of engaging or stimulating them, as did Caucasian parents in the United States. The authors attribute this to cultural conventions stemming from the belief that there is no purpose in speaking to infants as they will not understand what is being said (Richman, Miller & LeVine, 1992; LeVine, 2004).

There are also important differences in how parents within western cultures interact with their children. Numerous studies have identified SES disparities in the amount that parents talk to their children, which predicts children’s language and academic outcomes (refs). In an effort to identify the source of this disparity, Rowe (2008) discovered that parents’ knowledge of child development (as indexed by their scores on the Knowledge of Infant Development Inventory; KIDI) predicted their child-directed language, with more knowledgeable parents speaking to their children more even when controlling for the amount of speech directed at another adult. Although this study examined parents knowledge, and not their lay theories per se, this can be taken as evidence that parents are approaching parenting with different priors with regard to their roles as parents. 

There are other examples of parenting theories? dimensions on which parents differ; Lareau’s (2003) theory of “concerned cultivation” suggests that higher SES parents are more likely to view their child’s development as a project that requires a great deal of coordination in the form of activities and learning experiences, while lower SES parents are more likely to view their job as keeping their children safe from harm, with the assumption that they will naturally thrive if given independence. Furthermore, there have been hundreds of studies based on Baumrind’s (1971) framework that identifies parents as authoritative, authoritarian, or permissive, based on their levels of responsiveness and control in their interactions with their children. Thus, parents’ approach to parenting appear to vary in predictable ways based on their knowledge and perceptions surrounding children’s learning and development. A further question is whether these lay theories also moderate the uptake of new information.
Previous studies of parenting styles have generally relied on observation of parent-child interactions or self-report of specific activities and behaviors. To our knowledge there is not an existing measure of parents’ more general attitudes about parenting and child development, which might predict the uptake of interventions. The present study had two purposes: first, to establish a self-report scale to capture adults’ lay theories about child development and parenting, and second, to test the hypothesis that uptake will be greater for information consistent with people’s prior lay theories about child development.  

In order to establish a new measure of parenting attitudes, we followed a structured plan based on psychometric best practices (Clark & Watson, 1995; Furr, 2010; Simms, 2008). We generated items corresponding to three hypothesized latent theories about parenting: the Early Learning theory corresponds to a view of children’s early learning that is consistent with contemporary child development research, and includes the idea that young children can teach themselves by exploring and playing (refs). The Affection and Attachment theory captures the notion that close parent-child relationships are important for development, and includes the ideas that parents should talk to their children about their emotions and that children are not spoiled by too much affection (refs). The Rules and Respect theory corresponds to the idea that parents’ primary role is to enforce rules and encourage behavior control (refs). We generated items based on a review of the literature on parenting attitudes, and conducted psychometric analyses on iterative samples of respondents.

After establishing a final set of scale items, we conducted an experiment to test whether scores on the three subscales would predict people’s uptake of new information. For this purpose, we had participants read a popular press article on one of two parenting topics: an article arguing that free play is beneficial to children’s learning, or an article arguing that time-outs are harmful to children’s development. We operationalized uptake as accurate recall and generalization of the central messages of the target articles. We predicted that people’s scores on the Early Learning subscale would moderate uptake of the “free play” article, and that scores on the Rules and Respect scale would moderate uptake of the “time-outs” article. *(some description of findings that don’t exist yet).*

# Experiment 1

## Methods

### Participants

### Procedure


## Results


## Discussion

```{r}
files <- dir("../production-results/uptake_e2/")
d.raw <- data.frame()

for (f in files) {
  jf <- paste("../production-results/uptake_e2/",f,sep="")
  jd <- fromJSON(paste(readLines(jf), collapse=""))
  
  # clean up different tasks
  trial_type <- jd$answer$data$trial_type
  
  #parenting questionnaire 
  sent <- jd$answers$data$sentence[trial_type != "uptake"]
  rating <- as.numeric(jd$answers$data$rating[trial_type != "uptake"]) 
  
  #uptake experiment
  control_recall_1 = as.character(jd$answers$data$answer[1])
  control_recall_2 = as.character(jd$answers$data$answer[2])
  control_recall_3 = as.character(jd$answers$data$answer[3])
  control_recall_4 = as.character(jd$answers$data$answer[4])
  control_recall_5 = as.character(jd$answers$data$answer[5])
  target_generalize_1 = as.character(jd$answers$data$answer[6])
  target_generalize_2 = as.character(jd$answers$data$answer[7])
  target_generalize_3 = as.character(jd$answers$data$answer[8])
  target_generalize_4 = as.character(jd$answers$data$answer[9])
  target_generalize_5 = as.character(jd$answers$data$answer[10])
  target_recall_1 = as.character(jd$answers$data$answer[11])
  target_recall_2 = as.character(jd$answers$data$answer[12])
  target_recall_3 = as.character(jd$answers$data$answer[13])
  target_recall_4 = as.character(jd$answers$data$answer[14])
  target_recall_5 = as.character(jd$answers$data$answer[15])
  reading_time_target = jd$answers$data$target_rt[1]
  reading_time_control = jd$answers$data$control_rt[1]
  time_questionnaire = jd$answers$data$questionnaire_rt[1]
  
  
  #demographics
  race <- as.character(jd$answers$data$race[1])
  
  id <- data.frame(workerid = jd$WorkerId, 
                   sent = sent,
                   rating = rating,
                   enjoy_target = jd$answers$data$enjoy_target,
                   enjoy_control = jd$answers$data$enjoy_control,
                   reading_ease_target = jd$answers$data$reading_ease_target,
                   reading_ease_control = jd$answers$data$reading_ease_control,
                   target_recall_1 = target_recall_1,
                   target_recall_2 = target_recall_2,
                   target_recall_3 = target_recall_3,
                   target_recall_4 = target_recall_4,
                   target_recall_5 = target_recall_5,
                   target_generalize_1 = target_generalize_1,
                   target_generalize_2 = target_generalize_2,
                   target_generalize_3 = target_generalize_3,
                   target_generalize_4 = target_generalize_4,
                   target_generalize_5 = target_generalize_5,
                   control_recall_1 = control_recall_1,
                   control_recall_2 = control_recall_2,
                   control_recall_3 = control_recall_3,
                   control_recall_4 = control_recall_4,
                   control_recall_5 = control_recall_5,
                   children = jd$answers$data$children,
                   language = jd$answers$data$homelang,
                   ses = jd$answers$data$ladder,
                   gender = jd$answers$data$gender,
                   age = jd$answers$data$age,
                   education = jd$answers$data$education,
                   ethnicity = jd$answers$data$ethnicity,
                   childAgeYoung = jd$answers$data$childAgeYoung,
                   childAgeOld = jd$answers$data$childAgeOld,
                   race = race,
                   reading_time_target = reading_time_target,
                   reading_time_control = reading_time_control,
                   time_questionnaire = time_questionnaire)
  d.raw <- bind_rows(d.raw, id)
}
```

Map on question short forms so that we can use these instead. 

```{r}
labels <- read.csv("../analysis/sent_forms_e7.csv")
labels$sent <- as.character(labels$sent)

answers <- read.csv("../analysis/uptake_key.csv")
answers$tar_gen <-as.character(answers$tar_gen)
answers$tar_rec <-as.character(answers$tar_rec)
answers$con_rec <-as.character(answers$con_rec)
```

Clean up labels.

```{r}
d.raw$sent <- as.character(d.raw$sent)
d.raw$sent <- str_replace_all(d.raw$sent, "'", "")
d.raw$sent <- str_replace_all(d.raw$sent, "’", "")
d.raw$sent <- str_replace_all(d.raw$sent, "“", "")
d.raw$sent <- str_replace_all(d.raw$sent, "”", "")
d.raw$sent <- str_replace_all(d.raw$sent, "‘", "")
d.raw$sent <- str_replace_all(d.raw$sent, "â", "")
```

Merge. Recode uptake answers by accuracy.  

```{r}
d <- left_join(d.raw, labels)
d$rating[d$reverse_code == 1] <- 6 - d$rating[d$reverse_code == 1]

d$target_generalize_1[d$target_generalize_1 != answers$tar_gen[1]] <- 0
d$target_generalize_1[d$target_generalize_1 == answers$tar_gen[1]] <- 1
d$target_generalize_2[d$target_generalize_2 != answers$tar_gen[2]] <- 0
d$target_generalize_2[d$target_generalize_2 == answers$tar_gen[2]] <- 1
d$target_generalize_3[d$target_generalize_3 != answers$tar_gen[3]] <- 0
d$target_generalize_3[d$target_generalize_3 == answers$tar_gen[3]] <- 1
d$target_generalize_4[d$target_generalize_4 != answers$tar_gen[4]] <- 0
d$target_generalize_4[d$target_generalize_4 == answers$tar_gen[4]] <- 1
d$target_generalize_5[d$target_generalize_5 != answers$tar_gen[5]] <- 0
d$target_generalize_5[d$target_generalize_5 == answers$tar_gen[5]] <- 1

d$target_recall_1[d$target_recall_1 != answers$tar_rec[1]] <- 0
d$target_recall_1[d$target_recall_1 == answers$tar_rec[1]] <- 1
d$target_recall_2[d$target_recall_2 != answers$tar_rec[2]] <- 0
d$target_recall_2[d$target_recall_2 == answers$tar_rec[2]] <- 1
d$target_recall_3[d$target_recall_3 != answers$tar_rec[3]] <- 0
d$target_recall_3[d$target_recall_3 == answers$tar_rec[3]] <- 1
d$target_recall_4[d$target_recall_4 != answers$tar_rec[4]] <- 0
d$target_recall_4[d$target_recall_4 == answers$tar_rec[4]] <- 1
d$target_recall_5[d$target_recall_5 != answers$tar_rec[5]] <- 0
d$target_recall_5[d$target_recall_5 == answers$tar_rec[5]] <- 1

d$control_recall_1[d$control_recall_1 != answers$con_rec[1]] <- 0
d$control_recall_1[d$control_recall_1 == answers$con_rec[1]] <- 1
d$control_recall_2[d$control_recall_2 != answers$con_rec[2]] <- 0
d$control_recall_2[d$control_recall_2 == answers$con_rec[2]] <- 1
d$control_recall_3[d$control_recall_3 != answers$con_rec[3]] <- 0
d$control_recall_3[d$control_recall_3 == answers$con_rec[3]] <- 1
d$control_recall_4[d$control_recall_4 != answers$con_rec[4]] <- 0
d$control_recall_4[d$control_recall_4 == answers$con_rec[4]] <- 1
d$control_recall_5[d$control_recall_5 != answers$con_rec[5]] <- 0
d$control_recall_5[d$control_recall_5 == answers$con_rec[5]] <- 1
```

Plot demographic info.

```{r}
subinfo <- d %>%
  group_by(workerid) %>%
  select(-short_sent, -category, -instrument, -reverse_code) %>%
  distinct 

questions <- subinfo %>%
  select(workerid, starts_with("target"), starts_with("control")) %>%
  gather(question, correct, starts_with("target"), starts_with("control")) %>%
  separate(question, c("passage","trial_type","q_num"), sep = "_") %>%
  group_by(workerid, passage, trial_type) %>%
  summarise(correct = mean(as.numeric(correct))) %>%
  unite(trialtype, passage, trial_type) %>%
  spread(trialtype, correct)

subinfo <- subinfo %>%
  select(-starts_with("target"), -starts_with("control")) %>%
  left_join(questions) %>%
  select(-sent, -rating)
```


```{r}
subinfo$education <- factor(subinfo$education, 
                            levels = c("highSchool","someCollege","4year","someGrad","Grad"))

subinfo$gender <- str_replace_all(subinfo$gender, 
                              "female|FEMALE|F$|f$|Femal$|Females|Females","Female")
subinfo$gender <- str_replace_all(subinfo$gender, 
                                  "^male|^Male|^MALE|^M$|^m$|^Maleq|Make", "Male")
subinfo$gender <- str_replace_all(subinfo$gender, 
                                  "29|24|25|28|32|33|45", "")
subinfo$gender <- str_replace_all(subinfo$gender, 
                                  "males", "male")
subinfo$gender <- str_replace_all(subinfo$gender, " ", "")

subinfo$language <- str_replace_all(subinfo$language, "english|eNGLISH|Engliah|ENGLISH|^eng$|Enlgish", "English")
subinfo$language <- str_replace_all(subinfo$language," ", "")
subinfo$language <- str_replace_all(subinfo$language,"arabic", "Arabic")
subinfo$language <- str_replace_all(subinfo$language,"chinese", "Chinese")
subinfo$language <- str_replace_all(subinfo$language,"german", "German")
subinfo$language <- str_replace_all(subinfo$language,"tagalog", "Tagalog")

subinfo$youngestChildAge <- factor(subinfo$childAgeYoung, levels = c("","0to6mo","7to12mo","1y","2y","3y","4y","5y","6y","7y","8y","9y","10y","olderthan10"))

subinfo$oldestChildAge <- factor(subinfo$childAgeOld, levels = c("","0to6mo","7to12mo","1y","2y","3y","4y","5y","6y","7y","8y","9y","10y","olderthan10"))

subinfo$reading_ease_target <- factor(subinfo$reading_ease_target, levels = c("Very Difficult", "Somewhat Difficult", "Somewhat Easy", "Very Easy"))

subinfo$reading_ease_control <- factor(subinfo$reading_ease_control, levels = c("Very Difficult", "Somewhat Difficult", "Somewhat Easy", "Very Easy"))

subinfo$enjoy_target <- factor(subinfo$enjoy_target, levels = c("Very Unenjoyable", "Somewhat Unenjoyable", "Somewhat Enjoyable", "Very Enjoyable"))

subinfo$enjoy_control <- factor(subinfo$enjoy_control, levels = c("Very Unenjoyable", "Somewhat Unenjoyable", "Somewhat Enjoyable", "Very Enjoyable"))
```


```{r}
qplot(ses, data=subinfo)
qplot(children, data=subinfo)
qplot(gender, data=subinfo)
qplot(education, data=subinfo)
qplot(age, data=subinfo)
qplot(language, data=subinfo)
qplot(ethnicity, data=subinfo)
qplot(race, data=subinfo)
qplot(youngestChildAge, data=subinfo)
qplot(oldestChildAge, data=subinfo)
qplot(reading_ease_target, data=subinfo)
qplot(reading_ease_control, data=subinfo)
qplot(enjoy_target, data=subinfo)
qplot(enjoy_control, data=subinfo)
```

# Basic analyses

Now look at mean ratings across sentences.

```{r}
rating_count <- table(d$rating) 
rating_count
prop.table(rating_count) 

ms <- d %>%
  group_by(category, instrument, short_sent, reverse_code) %>%
  multi_boot_standard(col = "rating") %>%
  arrange(instrument, category, desc(mean)) 

ms$short_sent_ord <- factor(ms$short_sent, 
                             levels = ms$short_sent)

```

Plot attitude.

```{r}
qplot(short_sent_ord, mean, col = category,
      ymin = ci_lower, ymax = ci_upper, pch = factor(reverse_code),
      geom = "pointrange",
      data = filter(ms, instrument == "attitudes")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .5)) +
  xlab("") + 
  ylab("Mean Rating") + 
  ylim(c(0,6)) + 
  scale_colour_solarized()

```

Plot mean subscale scores.

```{r}
mc <- d %>%
  group_by(category) %>%
  multi_boot_standard(col = "rating") %>%
  arrange(category, desc(mean)) 

qplot(category, mean, 
      geom = "bar", stat = "identity", position = "dodge", 
      data=mc) + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9))
```

```{r}
mcl <- d %>%
  group_by(category, workerid) %>%
  multi_boot_standard(col = "rating") %>%
  arrange(category, desc(mean))%>%
  spread(category, mean) 
  
```

# Scale reliability

## Whole Scale

```{r}
wide.attitudes <- d %>% 
  filter(instrument == "attitudes") %>%
  select(workerid, short_sent, rating) %>% 
  spread(short_sent, rating)
alpha.mat <- as.matrix(select(wide.attitudes, -workerid))
alpha(x = alpha.mat)
```

## Rules and Respect Subscale

```{r}
wide.rules_respect <- d %>% 
  filter(category == "rules_respect") %>%
  select(workerid, short_sent, rating) %>% 
  spread(short_sent, rating)
alpha.rr <- as.matrix(select(wide.rules_respect, -workerid))
alpha(x = alpha.rr)
```

## Affection and Attachment Subscale

```{r}
wide.affection <- d %>% 
  filter(category == "affection") %>%
  select(workerid, short_sent, rating) %>% 
  spread(short_sent, rating)
alpha.af <- as.matrix(select(wide.affection, -workerid))
alpha(x = alpha.af)

```

## Active Learning Subscale

```{r}
wide.active_learning <- d %>% 
  filter(category == "active_learning") %>%
  select(workerid, short_sent, rating) %>% 
  spread(short_sent, rating)
alpha.al <- as.matrix(select(wide.active_learning, -workerid))
alpha(x = alpha.al)
```

# Subscales by demographics

Create a data frame that has subscale scores. 
```{r}
ss <- d %>%
  group_by(workerid, category) %>%
  summarize(rating = mean(rating))

ss <- left_join(ss, subinfo)
```

## By SES

```{r}
ms <- ss %>% 
  filter(ses != "") %>%
  mutate(ses.level = cut(as.numeric(ses), c(0,3,6,10))) %>%
  group_by(ses.level, category) %>%
  multi_boot_standard(col = "rating") 

ggplot(ms, aes(category, mean, fill=ses.level)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## By Race

Drop the sparsest groups. 

```{r}
ms <- ss %>% 
  filter(race != "NULL") %>%
  group_by(race, category) %>%
  filter(n() > 5) %>%
  multi_boot_standard(col = "rating")
  
ggplot(ms, aes(category, mean, fill=race)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## By Gender

```{r}
ms <- ss %>% 
  filter(gender %in% c("Male","Female")) %>%
  group_by(gender, category) %>%
  multi_boot_standard(col = "rating") 

ggplot(ms, aes(category, mean, fill=gender)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## By Education

Drop the sparsest groups. 

```{r}
ms <- ss %>% 
  filter(!is.na(education)) %>%
  group_by(education, category) %>%
  filter(n() > 5) %>%
  multi_boot_standard(col = "rating") 

ggplot(ms, aes(category, mean, fill=education)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## By Age

Drop the sparsest groups again. 

```{r}
ms <- ss %>% 
  filter(!is.na(age)) %>%
  group_by(age, category) %>%
  filter(n() > 5) %>%
  multi_boot_standard(col = "rating") 

ggplot(ms, aes(category, mean, fill=age)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## By Children

```{r}
ms <- ss %>% 
  filter(!is.na(children)) %>%
  group_by(children, category) %>%
  filter(n() > 5) %>%
  multi_boot_standard(col = "rating") 

ggplot(ms, aes(category, mean, fill=children)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## Factors by Ethnicity

```{r}
ms <- ss %>% 
  filter(ethnicity != "") %>%
  group_by(ethnicity, category) %>%
  filter(n() > 5) %>%
  multi_boot_standard(col = "rating") 

ggplot(ms, aes(category, mean, fill=ethnicity)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

# Factor analysis

Get eigenvalues for determining number of factors. 

```{r}
att.mat <- select(wide.attitudes, -workerid)

ev <- eigen(cor(x=att.mat)) # get eigenvalues

ap <- parallel(subject=nrow(att.mat), var=ncol(att.mat),
               rep=100,cent=.05)
nS <- nScree(x=ev$values, aparallel=ap$eigen$qevpea)
plotnScree(nS)
```

It still looks like Active/Early Learning and Affection are grouping together (with a separate factor that seems to focus on physical affection perhaps?), while Rules and Respect is separate. I'm still wondering if we need to re-think the structure of the subscales. It might be that Early Learning and Affection are not fully differentiated latent theories, and that they group together into a "child development is a project" theory.

```{r}
item.levels <- c("respect parents teachers", "wait when told","children should be grateful","punish for small rules", "dont impose structure", "kids should not decide", "safe loving environment", "holding and cradling", "give children comfort", "talk about emotions", "not spoiled with too much attention","too much affection does not harm", "can learn good and bad", "learn by playing", "learn from repetetive behaviors", "reasons for rules", "learn math before school", "reading before speaking")

n.factors <- 3

af <- factanal(x=att.mat, factors = n.factors, scores = "regression")
loadings <- data.frame(af$loadings[,1:n.factors]) %>%
  mutate(item = rownames(af$loadings)) %>%
  gather(factor, loading, starts_with("Factor"))
loadings$item <- factor(loadings$item, item.levels)

labels$item <- labels$short_sent
loadings <- join(loadings, labels, by = "item")

qplot(factor, item, fill=loading, geom="tile", data = loadings) + 
  scale_fill_continuous(low="#000000", high="#FFFFFF") + 
  facet_grid(category ~ ., scales = "free_y")

qplot(factor, item, fill=loading > .4, geom="tile", data = loadings) + 
  scale_fill_solarized() + 
  facet_grid(category ~ ., scales = "free_y")
```

Merge back in subject id info. 

```{r}
a.scores <- af$scores %>%
  data.frame %>%
  mutate(workerid = as.character(wide.attitudes$workerid)) %>%
  left_join(subinfo)
```

## Factors by SES

```{r}
a.factor.names <- c("Affection and Early Learning","Rules and Respect", "Affection 2")

mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(ses != "") %>%
  mutate(ses.level = cut(as.numeric(ses), c(0,3,6,10)),
         factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(ses.level, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=ses.level)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## Factors by Gender

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(gender %in% c("Male","Female")) %>%
  mutate(factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(gender, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=gender)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()

```
 
## Factors by Education

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(education != "") %>%
  mutate(factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(education, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=education)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## Factors by Age

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(age != "") %>%
  mutate(factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(age, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=age)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## Factors by Children

Do you have children?

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(children != "") %>%
  mutate(children = children %in% c("1","2","3","4","5","morethan5"),
         factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(children, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=children)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

How many?

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(children != "") %>%
  mutate(n.children = children,
         factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(n.children, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=n.children)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
```

## Factors by Ethnicity

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(ethnicity != "") %>%
  mutate(hispanic = ethnicity== "Hispanic",
         factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(hispanic, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=hispanic)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
``` 
 
## Factors by Race

```{r}
mf <- a.scores %>% 
  gather(factor, score, starts_with("Factor")) %>%
  filter(race != "NULL") %>%
  mutate(factor.num = as.numeric(str_replace(factor,"Factor","")),
         factor.name = a.factor.names[factor.num]) %>%
  group_by(race, factor.name) %>%
  multi_boot_standard(col = "score") 

ggplot(mf, aes(factor.name, mean, fill=race)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  scale_fill_solarized()
``` 


Alpha correlations within subscales were lower this time, perhaps because there were fewer items in each subscale (6).

The three factors are not separating out exactly as predicted, but getting closer. The main issue is that the Affection items (this time,"talk about emotions", "holding and cradling", and "safe loving environment") are loading onto the same factor as the Early Learning items. 


# Acknowledgements

This work supported by a gift from Kinedu, Inc. Thanks to members of the Language and Cognition Lab at Stanford for helpful discussion. 

# References 

\small