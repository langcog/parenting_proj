---
title             : "Measuring Lay Theories of Parenting and Child Development"
shorttitle        : "Measuring Parenting Theories"
author: 
  - name          : "Emily Hembacher"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
  - name          : "Michael C. Frank"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "450 Serra Mall, Stanford, CA 94301"
    email         : "mcfrank@stanford.edu"
affiliation:
  - id            : "1"
    institution   : "Stanford University"
author_note: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.
  Enter author note here.
abstract: |
  Enter abstract here. Each new line herein must be indented, like this line.
  
keywords          : "keywords"
wordcount         : "X"
bibliography      : ["paq.bib"]
figsintext        : yes
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : no
mask              : no
class             : "man"
output            : papaja::apa6_pdf
editor_options: 
  chunk_output_type: console
---

```{r}
knitr::opts_chunk$set(fig.width = 8, fig.height = 5, echo = FALSE, warning = FALSE, message = FALSE, cache = TRUE)
```

```{r load_packages, include = FALSE}
library(tidyverse)
library(psych)
library(langcog) 
library(ggthemes) #plot themes
library(rjson) #for json data
library(lme4) #mixed effects models
library(lmerTest) #nicer lmer output
library(tidyboot) #bootstrapped confidence intervals
library(magrittr)
library(papaja)
library(xtable)
library(gtable)
library(grid)
library(gridExtra)
```



# Methods


## Participants

## Material

## Procedure

## Data analysis



# Results

# Discussion



## Study 1: Demographic Factors

Approaches to parenting are known to differ across cultures and groups. For example, … To better understand whether the parenting attitudes captured by our survey reflect group differences, we examined average scores on the PAQ subscales based on demographic factors.  We administered the PAQ to 680 parents who were members of a local children’s museum and subsequently asked them to provide information about their gender, level of education, age, ethnicity, and the number of children they have. Figure X displays the distributions of demographic factors. To quantify any possible group differences, we conducted separate linear mixed-effects regressions for each subscale with the following structure: 

`score ~ age + education + ethnicity + gender + number of children + (1 | subject) + (1| item)`

```{r}
data <- read.csv("../cdm_paq.csv", header = TRUE)
dem <- read.csv("../cdm_paq_dem.csv", header = TRUE)
labels <- read.csv("../analysis/sent_forms_cdm.csv")
```

```{r}
#clean up data
questions <- data %>%
  filter(Status == "Response Type") %>%
  select(Q1:Q28) %>%
  gather("item", "sent", Q1:Q28)

d <- data %>%
  filter(Finished == 1) %>%
  mutate(sid = ResponseId) %>%
  select(sid, Q1:Q28) %>%
  gather("item", "rating", Q1:Q28) %>%
  left_join(questions)

subinfo <- dem %>%
  filter(Finished == "True") %>%
  transmute(sid = ResponseId, ethnicity = Q25.1, parent_ed = Q26.1, parent_age = Q27.1, parent_gender = Q28.1, num_kids = Q29, oldest_kid = Q30, youngest_kid = Q32, only_kid = Q33)

d$sent <- stringr::str_replace_all(d$sent, "’", "")
labels$sent <- as.character(labels$sent)
```

```{r}
#merge data with labels
dq <- d %>%
  left_join(labels)

#rescore reverse coded items
dq$rating <- as.numeric(dq$rating)
dq$rating[dq$reverse_code == 1] <- 8 - dq$rating[dq$reverse_code == 1]
dq$rating <- dq$rating - 1
```

```{r}
#create a dataframe that has subject scores and demographics
ss <- dq %>%
  group_by(sid, category) %>%
  summarise(rating = mean(rating))%>%
  left_join(subinfo)%>%
  mutate(parent_age_approx = parent_age,
         parent_ed_years = parent_ed)

#recode parent age to be continuous
ss$parent_age_approx <- recode(ss$parent_age_approx, "Under 18" = "18", "18 - 24" = "21", "25 - 34" = "30", "35 - 44" = "40", "45 - 54" = "50", "55 - 64" = "60", "65 - 74" = "70")
ss$parent_age_approx <- as.numeric(as.character(ss$parent_age_approx))

#recode parent ed to be continuous (num years)
ss$parent_ed_years <- recode(ss$parent_ed_years, "Less than high school" = "12", "High school graduate" = "12", "Some college" = "14", "2 year degree" = "14", "4 year degree" = "16", "Professional degree" = "19", "Doctorate" = "23")
ss$parent_ed_years <- as.numeric(as.character(ss$parent_ed_years))

ss$ethnicity <- as.character(ss$ethnicity)
ss$ethnicity[str_detect(ss$ethnicity, ",")] <- "Multiple Ethnicities"
```

```{r}
ms_gender <- ss %>% 
  filter(parent_gender %in% c("Male","Female")) %>%
  group_by(parent_gender, category) %>%
  tidyboot_mean(col = rating, na.rm = TRUE)

p_gender <- ggplot(ms_gender, aes(category, mean, fill=parent_gender)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  xlab("PAQ Subscale") + 
  ylab("PAQ Score") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_base()+ 
  scale_y_continuous(limits=c(0,6), breaks=c(0,2,4,6))+ 
  scale_fill_discrete(name="Parent Gender")+ 
  theme(legend.title = element_text(size=10), 
        legend.text = element_text(size=10), 
        axis.title.x=element_blank(),
        axis.text.y  = element_text(vjust=0.5, size=10),
        axis.title.y = element_text(size=12))
```

```{r echo = FALSE}
ms_age <- ss %>% 
  group_by(parent_age, category) %>%
  filter(n() > 20)%>%
  tidyboot_mean(col = rating)

p_age <- ggplot(ms_age, aes(category, mean, fill=parent_age)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  xlab("PAQ Subscale") + 
  ylab("PAQ Score") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_base()+ 
  scale_y_continuous(limits=c(0,6), breaks=c(0,2,4,6))+ 
  scale_fill_discrete(name="Parent Age")+ 
  theme(legend.title = element_text(size=10), 
        legend.text = element_text(size=10), 
        axis.title.x=element_blank(),
        axis.text.y  = element_text(vjust=0.5, size=10),
        axis.title.y = element_text(size=12))
```

```{r echo = FALSE}
ss$parent_ed <- factor(ss$parent_ed, levels = c("Less than high school","High school graduate","Some college","2 year degree","4 year degree", "Professional degree", "Doctorate"))

ms_ed <- ss %>% 
  group_by(parent_ed, category) %>%
  filter(n() > 20)%>%
  tidyboot_mean(col = rating)

p_ed <- ggplot(ms_ed, aes(category, mean, fill=parent_ed)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  xlab("PAQ Subscale") + 
  ylab("PAQ Score") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_base()+ 
  scale_y_continuous(limits=c(0,6), breaks=c(0,2,4,6))+ 
  scale_fill_discrete(name="Parent Education")+ 
  theme(legend.title = element_text(size=10), 
        legend.text = element_text(size=10), 
        axis.title.x=element_blank(),
        axis.text.y  = element_text(vjust=0.5, size=10),
        axis.title.y = element_text(size=12))
```

```{r echo = FALSE}
ms_ethnic <- ss %>% 
  group_by(ethnicity, category) %>%
  filter(n() > 20)%>%
  tidyboot_mean(col = rating)

p_ethnic <- ggplot(ms_ethnic, aes(category, mean, fill=ethnicity)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  xlab("PAQ Subscale") + 
  ylab("PAQ Score") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_base()+ 
  scale_y_continuous(limits=c(0,6), breaks=c(0,2,4,6))+ 
  scale_fill_discrete(name="Parent Ethnicity")+ 
  theme(legend.title = element_text(size=10), 
        legend.text = element_text(size=10), 
        axis.title.x=element_blank(),
        axis.text.y  = element_text(vjust=0.5, size=10),
        axis.title.y = element_text(size=12))
```

```{r echo = FALSE}
ms_numkids <- ss %>% 
  group_by(num_kids, category) %>%
  filter(n() > 20)%>%
  tidyboot_mean(col = rating)

p_numkids <- ggplot(ms_numkids, aes(category, mean, fill=num_kids)) +
  geom_bar(stat="identity", position = "dodge") + 
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper), 
             position = position_dodge(width = .9)) + 
  xlab("PAQ Subscale") + 
  ylab("PAQ Score") +
  langcog::scale_colour_solarized()  +
  ggthemes::theme_base()+ 
  scale_y_continuous(limits=c(0,6), breaks=c(0,2,4,6))+ 
  scale_fill_discrete(name="Number of Children")+ 
  theme(legend.title = element_text(size=10), 
        legend.text = element_text(size=10), 
        axis.title.x=element_blank(),
        axis.text.y  = element_text(vjust=0.5, size=10),
        axis.title.y = element_text(size=12))
```

```{r echo = FALSE, fig.width=10, fig.height=8,}
grid.arrange(p_age, p_ed, p_ethnic, p_gender, p_numkids, nrow = 3)
```

```{r}
aa_demo <- summary(lm(rating ~ as.numeric(parent_age) + ethnicity + as.numeric(parent_ed_years) + as.numeric(num_kids) + parent_gender, 
     data=filter(ss, category == "AA", 
                 ethnicity %in% ms_ethnic$ethnicity,
                 parent_gender %in% ms_gender$parent_gender)))
```

```{r}
rr_demo <- summary(lm(rating ~ as.numeric(parent_age) + ethnicity + as.numeric(parent_ed_years) + as.numeric(num_kids) + parent_gender, 
     data=filter(ss, category == "RR", ethnicity %in% ms_ethnic$ethnicity,
                 parent_gender %in% ms_gender$parent_gender)))
```

```{r}
el_demo <- summary(lm(rating ~ as.numeric(parent_age) + ethnicity + as.numeric(parent_ed_years) + as.numeric(num_kids) + parent_gender, 
     data=filter(ss, category == "EL", ethnicity %in% ms_ethnic$ethnicity,
                 parent_gender %in% ms_gender$parent_gender)))
```

```{r results = "asis"}
tab_aa_demo <- data.frame(aa_demo$coefficients)
tab_el_demo <- data.frame(el_demo$coefficients)
tab_rr_demo <- data.frame(rr_demo$coefficients)

factors <- c("Intercept", "Parent Age", "Hispanic or Latino", "Multiple Ethnicities", "White", "Parent Education", "Number of children", "Male", "Intercept", "Parent Age", "Hispanic or Latino", "Multiple Ethnicities", "White", "Parent Education", "Number of children", "Male","Intercept", "Parent Age", "Hispanic or Latino", "Multiple Ethnicities", "White", "Parent Education", "Number of children", "Male")

subscales <- c("Affection and Attachment", "", "", "", "", "", "","",
               "Early Learning", "", "", "", "", "", "","",
               "Rules and Respect", "", "", "", "", "", "","")

tab_demo_lm <- tab_aa_demo%>%
  bind_rows(tab_el_demo)%>%
  bind_rows(tab_rr_demo)%>%
  mutate(Subscale = subscales,
         Factor = factors)
         
tab_demo_lm  <- tab_demo_lm [,c(5,6,1:4)]

colnames(tab_demo_lm) <- c("Subscale","Factor","Estimate", "SE", "$t$ value", "$p$ value")

tab_demo_lm  %<>% 
  mutate(
    stars = ifelse(`$p$ value` > .1, "", 
                   ifelse(`$p$ value` < .001, "***",
                          ifelse(`$p$ value` < .01, "**",
                                 ifelse(`$p$ value` < .05, "*",
                                        ifelse(`$p$ value` < .1, ".", "Error"))))),
    
    `$p$ value` = ifelse(`$p$ value` > .1, round(`$p$ value`, 2), 
                         ifelse(`$p$ value` < .001, "$<$ .001",
                                ifelse(`$p$ value` < .01, round(`$p$ value`, 2),
                                       ifelse(`$p$ value` < .05, round(`$p$ value`, 2),
                                              ifelse(`$p$ value` < .1, round(`$p$ value`, 2), 
                                                     "Error")))))
  )

colnames(tab_demo_lm) <- c("","","Estimate", "SE", "$t$ value", "$p$ value", "")

aalm_tab <- xtable::xtable(tab_demo_lm, caption = "Results of a linear regression of demographic factors on  PAQ scores.")

print(aalm_tab, type="latex", comment = F, table.placement = "b",
      floating.environment = "table",hline.after = c(0,8, 16), include.rownames=FALSE, sanitize.text.function=function(x){x}, align = c("l","l","r","r","r","r","l"))
```


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
